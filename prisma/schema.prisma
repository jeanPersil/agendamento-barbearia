// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

//////////////////////
// ENUMS
//////////////////////

enum Role {
  CLIENTE
  PROFISSIONAL
  ADMIN
}

enum StatusAgendamento {
  AGENDADO
  CONCLUIDO
  CANCELADO
  FALTOU
}

//////////////////////
// USER (base do sistema)
//////////////////////

model User {
  id              String    @id @default(uuid())
  nome            String
  email           String    @unique
  senha           String
  telefone        String
  imagemUrl       String?
  role            Role
  horariosCriados Horario[]

  bannedAt     DateTime?
  bannedReason String?

  // Relações
  agendamentosComoCliente      Agendamento[] @relation("ClienteAgendamentos")
  agendamentosComoProfissional Agendamento[] @relation("ProfissionalAgendamentos")
  createdAt                    DateTime      @default(now())
  updatedAt                    DateTime      @updatedAt
}

//////////////////////
// SERVIÇOS DA BARBEARIA
//////////////////////

model Servico {
  id         String  @id @default(uuid())
  nome       String  @unique
  descricao  String
  preco      Decimal
  duracaoMin Int

  agendamentos Agendamento[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////
// AGENDAMENTOS
//////////////////////
model Agendamento {
  id       String            @id @default(uuid())
  dataHora DateTime
  status   StatusAgendamento @default(AGENDADO)

  // Guarda o valor do serviço no momento do agendamento
  precoHistorico Decimal

  //////////////////////
  // RELAÇÕES
  //////////////////////
  clienteId String
  cliente   User   @relation("ClienteAgendamentos", fields: [clienteId], references: [id])

  profissionalId String
  profissional   User   @relation("ProfissionalAgendamentos", fields: [profissionalId], references: [id])

  servicoId        String
  servico          Servico   @relation(fields: [servicoId], references: [id])
  horariosOcupados Horario[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Horario {
  id         String   @id @default(uuid())
  dataHora   DateTime
  disponivel Boolean  @default(true) 

  profissionalId String
  profissional   User   @relation(fields: [profissionalId], references: [id])

  agendamentoId String?
  agendamento   Agendamento? @relation(fields: [agendamentoId], references: [id])

  @@unique([profissionalId, dataHora]) 
}
