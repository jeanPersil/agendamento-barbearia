generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

//////////////////////
// ENUMS
//////////////////////

enum Role {
  CLIENTE
  PROFISSIONAL
  ADMIN
}

enum StatusAgendamento {
  AGENDADO
  CONCLUIDO
  CANCELADO
  FALTOU
}

//////////////////////
// USER
//////////////////////

model User {
  id        String  @id @default(uuid())
  nome      String
  email     String  @unique
  senha     String
  telefone  String
  imagemUrl String?
  role      Role

  bannedAt     DateTime?
  bannedReason String?

  // Relações
  agendamentosComoCliente      Agendamento[] @relation("ClienteAgendamentos")
  agendamentosComoProfissional Agendamento[] @relation("ProfissionalAgendamentos")

  disponibilidades Disponibilidade[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////
// SERVIÇOS
//////////////////////

model Servico {
  id         String  @id @default(uuid())
  nome       String  @unique
  descricao  String
  preco      Decimal
  duracaoMin Int

  agendamentos Agendamento[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////
// AGENDAMENTOS
//////////////////////

model Agendamento {
  id      String            @id @default(uuid())
  data    DateTime
  horario String
  status  StatusAgendamento @default(AGENDADO)

  precoHistorico Decimal

  //////////////////////
  // RELAÇÕES
  //////////////////////
  clienteId String
  cliente   User   @relation("ClienteAgendamentos", fields: [clienteId], references: [id])

  profissionalId String
  profissional   User   @relation("ProfissionalAgendamentos", fields: [profissionalId], references: [id])

  servicoId String
  servico   Servico @relation(fields: [servicoId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // impede dois agendamentos no mesmo horário pro mesmo profissional
  @@unique([profissionalId, data, horario])
}

//////////////////////
// DISPONIBILIDADE (agenda base)
//////////////////////

model Disponibilidade {
  id         Int    @id @default(autoincrement())
  diaSemana  Int // 0=Dom, 1=Seg...
  horaInicio String // "08:00"
  horaFim    String // "18:00"

  profissionalId String
  profissional   User   @relation(fields: [profissionalId], references: [id])

  createdAt DateTime @default(now())
}
